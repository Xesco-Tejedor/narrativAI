<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ­ narrativAI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: linear-gradient(135deg, #0f0f23, #1a1a2e, #16213e );
            min-height: 100vh;
        }
        .genre-card {
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        .genre-card.selected {
            border-color: #8b5cf6;
            background: rgba(139, 92, 246, 0.1);
        }
        .genre-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.3);
        }
        .weight-slider {
            accent-color: #8b5cf6;
        }
        .loading-animation {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .generated-text {
            animation: fadeIn 0.8s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        #narrativeTextEditor {
            scrollbar-width: thin;
            scrollbar-color: #8b5cf6 #374151;
        }
        
        #narrativeTextEditor::-webkit-scrollbar {
            width: 6px;
        }
        
        #narrativeTextEditor::-webkit-scrollbar-track {
            background: #374151;
            border-radius: 3px;
        }
        
        #narrativeTextEditor::-webkit-scrollbar-thumb {
            background: #8b5cf6;
            border-radius: 3px;
        }
        
        #narrativeTextEditor::-webkit-scrollbar-thumb:hover {
            background: #a855f7;
        }
        
        #narrativeTextEditor:focus {
            box-shadow: 0 0 0 2px rgba(139, 92, 246, 0.3);
            border-radius: 4px;
        }
    </style>
</head>
<body class="text-white">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <div class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-bold bg-gradient-to-r from-purple-400 via-pink-500 to-red-500 bg-clip-text text-transparent mb-4">
                ğŸ­ narrativAI
            </h1>
            <p class="text-xl text-gray-300 mb-2">
                ğŸ“š Narrativas especÃ­ficas con elementos personalizados literales
            </p>
            <p class="text-lg text-purple-300 mb-4">
                ğŸ¬ Hasta 3 gÃ©neros balanceados + ImÃ¡genes Ã©picas cinematogrÃ¡ficas usando IA real
            </p>
            
            <!-- Banner conceptual -->
            <div class="max-w-4xl mx-auto mb-6 p-6 bg-gradient-to-r from-purple-900/30 to-pink-900/30 rounded-xl border border-purple-500/30">
                <div class="text-center">
                    <div class="text-6xl mb-4">ğŸ­âœ¨ğŸ“š</div>
                    <p class="text-lg text-purple-200 mb-2">
                        <strong>Transforma elementos simples en narrativas Ã©picas</strong>
                    </p>
                    <p class="text-md text-gray-300">
                        Elementos personalizados + GÃ©neros balanceados + IA cinematogrÃ¡fica
                    </p>
                    <p class="text-sm text-purple-300 mt-2">
                        â¬‡ï¸ <em>Tus elementos cobran vida en historias Ãºnicas con imÃ¡genes Ã©picas</em> â¬‡ï¸
                    </p>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Panel de configuraciÃ³n -->
            <div class="space-y-6">
                <!-- SelecciÃ³n de gÃ©neros con lÃ­mite -->
                <div class="bg-gray-800/50 backdrop-blur-sm rounded-xl p-6 border border-gray-700">
                    <h3 class="text-lg font-semibold text-purple-400 mb-4 flex items-center">
                        ğŸ­ Selecciona gÃ©neros (mÃ¡ximo 3)
                        <span id="genreCount" class="ml-2 text-sm bg-purple-600 px-2 py-1 rounded-full">0/3</span>
                    </h3>
                    
                    <div class="grid grid-cols-2 gap-3 mb-4" id="genreGrid">
                        <!-- GÃ©neros se generan dinÃ¡micamente -->
                    </div>

                    <!-- Controles de peso para gÃ©neros seleccionados -->
                    <div id="weightControls" class="space-y-3 hidden">
                        <h4 class="text-md font-medium text-gray-300 border-t border-gray-600 pt-3">
                            âš–ï¸ Ajustar influencia de gÃ©neros
                        </h4>
                        <div id="weightSliders"></div>
                    </div>
                </div>

                <!-- Elementos personalizados mejorados -->
                <div class="bg-gray-800/50 backdrop-blur-sm rounded-xl p-6 border border-gray-700">
                    <h3 class="text-lg font-semibold text-purple-400 mb-4">
                        âœ¨ Elementos personalizados (aparecen literalmente)
                    </h3>
                    <div class="space-y-3">
                        <div>
                            <label class="block text-sm text-gray-300 mb-1">
                                ğŸ¯ Elemento principal (foco de la historia)
                            </label>
                            <input type="text" id="element1" placeholder="ej: pececillo de plata" class="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg focus:outline-none focus:border-purple-500 text-white">
                        </div>
                        <div>
                            <label class="block text-sm text-gray-300 mb-1">
                                ğŸ”¸ Elemento secundario (apoyo narrativo)
                            </label>
                            <input type="text" id="element2" placeholder="ej: biblioteca gigantesca" class="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg focus:outline-none focus:border-purple-500 text-white">
                        </div>
                        <div>
                            <label class="block text-sm text-gray-300 mb-1">
                                ğŸ›ï¸ Elemento de contexto (puede definir escenario)
                            </label>
                            <input type="text" id="element3" placeholder="ej: voluminoso y antiguo libro" class="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg focus:outline-none focus:border-purple-500 text-white">
                        </div>
                    </div>
                </div>

                <!-- ConfiguraciÃ³n de IA para imÃ¡genes -->
                <div class="bg-gray-800/50 backdrop-blur-sm rounded-xl p-6 border border-gray-700">
                    <div class="flex items-center space-x-3 mb-4">
                        <input type="checkbox" id="useImageAI" class="w-5 h-5 text-purple-600 bg-gray-700 border-gray-600 rounded focus:ring-purple-500">
                        <label for="useImageAI" class="text-lg font-semibold text-purple-400">
                            ğŸ¬ Generar imagen Ã©pica cinematogrÃ¡fica
                        </label>
                    </div>
                    
                    <div id="imageAIInfo" class="hidden mt-2 p-3 bg-blue-900/20 border border-blue-500/30 rounded text-sm text-blue-300">
                        ğŸ¬ <strong>Imagen Ã©pica generada con IA real:</strong> Se analizarÃ¡ tu texto narrativo para crear una imagen Ãºnica<br />
                        <small class="opacity-80">ğŸ­ La IA interpretarÃ¡ tu narrativa y elementos personalizados para generar la imagen perfecta</small>
                    </div>

                    <!-- Estilos visuales predeterminados -->
                    <div id="visualStylesSection" class="hidden mt-4">
                        <label for="visualStyle" class="block text-sm font-medium text-gray-300 mb-2">
                            ğŸ¨ Estilo visual predeterminado
                        </label>
                        <select id="visualStyle" class="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg focus:outline-none focus:border-purple-500 text-white">
                            <option value="auto">AutomÃ¡tico (basado en gÃ©neros)</option>
                            <option value="mignola-style">ğŸ¨ Estilo Mike Mignola (sombras dramÃ¡ticas)</option>
                            <option value="toth-style">ğŸ¨ Estilo Alex Toth (lÃ­neas elegantes)</option>
                            <option value="sienkiewicz-style">ğŸ¨ Estilo Bill Sienkiewicz (expresionista)</option>
                            <option value="williams-style">ğŸ¨ Estilo J H Williams III (layouts innovadores)</option>
                            <option value="schuiten-style">ğŸ¨ Estilo FranÃ§ois Schuiten (ligne claire)</option>
                            <option value="hogarth-style">ğŸ¨ Estilo Burne Hogarth (anatomÃ­a dinÃ¡mica)</option>
                            <option value="wrightson-style">ğŸ¨ Estilo Bernie Wrightson (horror gÃ³tico)</option>
                            <option value="frazetta-style">ğŸ¨ Estilo Frank Frazetta (fantasÃ­a heroica)</option>
                            <option value="graphic-novel">Novela grÃ¡fica clÃ¡sica</option>
                            <option value="photorealistic">Fotorrealista</option>
                            <option value="digital-art">Arte digital</option>
                            <option value="concept-art">Arte conceptual</option>
                            <option value="cinematic">CinematogrÃ¡fico</option>
                            <option value="fantasy-art">Arte fantÃ¡stico</option>
                            <option value="vintage-poster">PÃ³ster vintage</option>
                        </select>
                    </div>

                    <!-- Posados y acciones de portada -->
                    <div id="poseActionsSection" class="hidden mt-4">
                        <label for="poseAction" class="block text-sm font-medium text-gray-300 mb-2">
                            ğŸ­ Posado/AcciÃ³n de portada
                        </label>
                        <select id="poseAction" class="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg focus:outline-none focus:border-purple-500 text-white">
                            <option value="auto">AutomÃ¡tico (basado en narrativa)</option>
                            <option value="hero-stance">Postura heroica central</option>
                            <option value="discovery-moment">Momento de descubrimiento</option>
                            <option value="action-dynamic">AcciÃ³n dinÃ¡mica</option>
                            <option value="contemplative-gaze">Mirada contemplativa al horizonte</option>
                            <option value="confrontation">ConfrontaciÃ³n dramÃ¡tica</option>
                            <option value="group-formation">FormaciÃ³n de grupo</option>
                            <option value="silhouette-dramatic">Silueta dramÃ¡tica</option>
                            <option value="embrace-romantic">Abrazo romÃ¡ntico</option>
                            <option value="mystery-investigation">InvestigaciÃ³n misteriosa</option>
                            <option value="magical-casting">Conjuro mÃ¡gico</option>
                            <option value="chase-escape">PersecuciÃ³n/Escape</option>
                            <option value="throne-power">PosiciÃ³n de poder</option>
                        </select>
                    </div>

                    <!-- Engine de imagen -->
                    <div id="imageEngineSection" class="hidden mt-4">
                        <label for="imageEngine" class="block text-sm font-medium text-gray-300 mb-2">
                            ğŸš€ Engine de generaciÃ³n de imagen
                        </label>
                        <select id="imageEngine" class="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg focus:outline-none focus:border-purple-500 text-white">
                            <option value="auto">ğŸ”„ Auto (selecciÃ³n inteligente segÃºn el estilo)</option>
                            <option value="pollinations-ai">ğŸ¨ Pollinations.ai (generaciÃ³n directa por URL)</option>
                            <!-- <option value="gpt-image-1">ğŸ¬ gpt-image-1 (rÃ¡pido y confiable)</option> -->
                            <!-- <option value="seedimage-3">ğŸ¨ SeedImage 3.0 (alta calidad artÃ­stica)</option> -->
                        </select>
                        <div class="mt-2 text-xs text-gray-400 space-y-1">
                            <div id="engineInfo" class="p-2 bg-gray-800/50 rounded border border-gray-600">
                                <p class="font-medium text-purple-300">ğŸ”„ SelecciÃ³n automÃ¡tica:</p>
                                <p>â€¢ Estilos de cÃ³mic maestros â†’ Pollinations.ai</p>
                                <p>â€¢ Fotorrealista/CinematogrÃ¡fico â†’ Pollinations.ai</p>
                                <p>â€¢ Genera la mejor calidad segÃºn tu elecciÃ³n de estilo</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- BotÃ³n de generaciÃ³n -->
                <button id="generateBtn" class="w-full bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white font-bold py-4 px-6 rounded-xl transition-all duration-300 transform hover:scale-105 hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none">
                    <span id="generateBtnText">ğŸ­ Generar Argumento Ã‰pico</span>
                </button>
            </div>

            <!-- Panel de resultados -->
            <div class="space-y-6">
                <!-- Argumento generado -->
                <div class="bg-gray-800/50 backdrop-blur-sm rounded-xl p-6 border border-gray-700">
                    <h3 class="text-lg font-semibold text-purple-400 mb-4">ğŸ“– Argumento Generado</h3>
                    
                    <div id="narrativePlaceholder" class="text-center text-gray-400 py-12">
                        <div class="text-4xl mb-3">ğŸ“š</div>
                        <p>Selecciona gÃ©neros y elementos para generar tu narrativa Ã©pica</p>
                    </div>
                    
                    <div id="narrativeContent" class="hidden">
                        <div class="bg-gray-900/50 rounded-lg border-l-4 border-purple-500">
                            <!-- Ãrea de texto editable -->
                            <div class="relative">
                                <textarea 
                                    id="narrativeTextEditor" 
                                    class="w-full min-h-48 p-4 bg-transparent text-gray-100 leading-relaxed resize-none border-none outline-none"
                                    placeholder="Tu narrativa editada aparecerÃ¡ aquÃ­..."
                                    style="font-family: inherit; line-height: 1.6;"
                                ></textarea>
                                <div class="absolute top-2 right-2 opacity-60 hover:opacity-100 transition-opacity">
                                    <span class="text-xs text-purple-300 bg-purple-900/50 px-2 py-1 rounded">
                                        âœï¸ Editable
                                    </span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="flex flex-wrap gap-2 mt-4">
                            <button id="copyBtn" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg transition-colors text-sm">
                                ğŸ“‹ Copiar texto
                            </button>
                            <button id="exportBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors text-sm">
                                ğŸ’¾ Exportar ZIP
                            </button>
                            <button id="generateImageBtn" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors text-sm hidden">
                                ğŸ¬ Generar Imagen del Texto Editado
                            </button>
                            <button id="regenerateNarrativeBtn" class="bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-lg transition-colors text-sm">
                                ğŸ­ Regenerar Narrativa
                            </button>
                        </div>
                    </div>
                    
                    <div id="loadingNarrative" class="hidden text-center py-8">
                        <div class="loading-animation text-4xl mb-3">ğŸ­</div>
                        <p class="text-purple-300">Creando tu narrativa Ã©pica...</p>
                    </div>
                </div>

                <!-- Ãrea de imagen generada -->
                <div class="bg-gray-800/50 backdrop-blur-sm rounded-xl p-6 border border-gray-700">
                    <h3 class="text-lg font-semibold text-purple-400 mb-4">ğŸ¬ Imagen Ã‰pica CinematogrÃ¡fica</h3>
                    
                    <h4 class="text-md font-medium text-purple-300 mb-3">ğŸ­ Tu imagen Ã©pica aparecerÃ¡ aquÃ­:</h4>
                        
                        <div id="imagePlaceholder" class="text-center text-gray-400 py-8 border-2 border-dashed border-gray-600 rounded-lg">
                            <div class="text-3xl mb-2">ğŸ–¼ï¸</div>
                            <p class="text-sm">Activa la generaciÃ³n de imÃ¡genes para ver tu escena Ã©pica personalizada</p>
                        </div>
                        
                        <img id="narrativeImage" class="hidden w-full rounded-lg shadow-xl border border-gray-600 hover:shadow-2xl transition-shadow duration-300" alt="Imagen Ã©pica generada">
                        
                        <div id="loadingImage" class="hidden text-center py-8 border-2 border-dashed border-purple-500 rounded-lg">
                            <div class="loading-animation text-3xl mb-2">ğŸ¬</div>
                            <p class="text-purple-300 text-sm">Generando tu imagen Ã©pica cinematogrÃ¡fica...</p>
                        </div>
                        
                        <div id="imageStatus" class="mt-3 p-2 bg-green-900/30 rounded border border-green-500/50 text-xs text-green-300 hidden">
                            <!-- Status se actualiza dinÃ¡micamente -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="mt-12 text-center text-gray-400 text-sm">
            <p>
                âœ¨ Generador de Argumentos Narrativos - Narrativas especÃ­ficas con elementos personalizados literales
            </p>
            <p class="mt-1">
                ğŸ¬ Hasta 3 gÃ©neros balanceados + ImÃ¡genes Ã©picas cinematogrÃ¡ficas de tus elementos en acciÃ³n
            </p>
            <p class="mt-4 text-xs">
                ğŸ™ Agradecimientos especiales a <a href="https://perchance.org" target="_blank" rel="noopener noreferrer" class="text-purple-400 hover:text-purple-300 transition-colors underline">Perchance.org</a> por su increÃ­ble plataforma de generaciÃ³n AI
            </p>
        </div>
    </div>

    <script type="module">
        // Estado de la aplicaciÃ³n
        let appState = {
            selectedGenres: [], // Array de objetos: { id, weight }
            customElements: '',
            generatedNarrative: '',
            generatedImageUrl: '',
            useImageAI: false,
            visualStyle: 'auto',
            poseAction: 'auto',
            imageEngine: 'auto', // Cambiado a 'auto' por defecto
            isGenerating: false,
            isGeneratingImage: false
        };

        // DefiniciÃ³n de gÃ©neros disponibles
        const genres = {
            'terror': {
                name: 'Terror',
                icon: 'ğŸ‘»',
                color: 'from-red-600 to-red-800'
            },
            'ciencia-ficcion': {
                name: 'Ciencia FicciÃ³n',
                icon: 'ğŸš€',
                color: 'from-blue-600 to-blue-800'
            },
            'fantasia': {
                name: 'FantasÃ­a',
                icon: 'ğŸ§™â€â™‚ï¸',
                color: 'from-purple-600 to-purple-800'
            },
            'romance': {
                name: 'Romance',
                icon: 'ğŸ’•',
                color: 'from-pink-600 to-pink-800'
            },
            'misterio': {
                name: 'Misterio',
                icon: 'ğŸ”',
                color: 'from-yellow-600 to-yellow-800'
            },
            'aventura': {
                name: 'Aventura',
                icon: 'âš”ï¸',
                color: 'from-green-600 to-green-800'
            },
            'comedia': {
                name: 'Comedia',
                icon: 'ğŸ˜„',
                color: 'from-orange-600 to-orange-800'
            },
            'drama': {
                name: 'Drama',
                icon: 'ğŸ­',
                color: 'from-indigo-600 to-indigo-800'
            }
        };

        // Crear elementos de gÃ©nero en el DOM
        const createGenreElements = ( ) => {
            const genreGrid = document.getElementById('genreGrid');
            
            Object.keys(genres).forEach(genreId => {
                const genre = genres[genreId];
                const genreCard = document.createElement('div');
                genreCard.className = `genre-card bg-gradient-to-br ${genre.color} p-4 rounded-lg cursor-pointer text-center`;
                genreCard.dataset.genreId = genreId;
                
                genreCard.innerHTML = `
                    <div class="text-2xl mb-2">${genre.icon}</div>
                    <div class="text-sm font-medium">${genre.name}</div>
                `;
                
                genreCard.addEventListener('click', () => {
                    toggleGenre(genreId);
                });
                
                genreGrid.appendChild(genreCard);
            });
        };

        // Alternar selecciÃ³n de gÃ©nero
        const toggleGenre = (genreId) => {
            const genreCard = document.querySelector(`[data-genre-id="${genreId}"]`);
            const isSelected = appState.selectedGenres.some(g => g.id === genreId);
            
            if (isSelected) {
                // Remover gÃ©nero
                appState.selectedGenres = appState.selectedGenres.filter(g => g.id !== genreId);
                genreCard.classList.remove('selected');
            } else {
                // AÃ±adir gÃ©nero (mÃ¡ximo 3)
                if (appState.selectedGenres.length < 3) {
                    // Calcular redistribuciÃ³n proporcional para el nuevo gÃ©nero
                    const currentGenresCount = appState.selectedGenres.length;
                    
                    if (currentGenresCount === 0) {
                        // Primer gÃ©nero: 100%
                        appState.selectedGenres.push({
                            id: genreId,
                            weight: 100
                        });
                    } else {
                        // Reducir proporcionalmente los gÃ©neros existentes
                        const newGenreWeight = 100 / (currentGenresCount + 1);
                        const existingTotalWeight = 100 - newGenreWeight;
                        const scaleFactor = existingTotalWeight / 100;
                        
                        // Ajustar gÃ©neros existentes
                        appState.selectedGenres.forEach(genre => {
                            genre.weight = genre.weight * scaleFactor;
                        });
                        
                        // AÃ±adir nuevo gÃ©nero
                        appState.selectedGenres.push({
                            id: genreId,
                            weight: newGenreWeight
                        });
                    }
                    
                    genreCard.classList.add('selected');
                } else {
                    alert('MÃ¡ximo 3 gÃ©neros permitidos. Deselecciona uno primero.');
                    return;
                }
            }
            
            updateGenreCount();
            updateWeightControls();
        };

        // Redistribuir pesos para que sumen exactamente 100
        const redistributeWeights = () => {
            if (appState.selectedGenres.length === 0) return;
            
            const totalCurrent = appState.selectedGenres.reduce((sum, g) => sum + g.weight, 0);
            
            if (Math.abs(totalCurrent - 100) > 0.1) {
                // Si no hay pesos establecidos o la suma estÃ¡ muy desbalanceada
                if (totalCurrent === 0 || appState.selectedGenres.every(g => g.weight === 0)) {
                    // DistribuciÃ³n inicial equitativa
                    const equalWeight = 100 / appState.selectedGenres.length;
                    appState.selectedGenres.forEach(genre => {
                        genre.weight = equalWeight;
                    });
                } else {
                    // Normalizar manteniendo proporciones existentes
                    const scaleFactor = 100 / totalCurrent;
                    appState.selectedGenres.forEach(genre => {
                        genre.weight = genre.weight * scaleFactor;
                    });
                }
            }
        };

        // Redistribuir pesos cuando uno cambia (mÃ©todo fluido y proporcional)
        const redistributeWeightsFromChange = (changedIndex, newWeight) => {
            const oldWeight = appState.selectedGenres[changedIndex].weight;
            const weightDifference = newWeight - oldWeight;
            
            // Obtener otros gÃ©neros que no cambiaron
            const otherGenres = appState.selectedGenres.filter((_, index) => index !== changedIndex);
            
            if (otherGenres.length === 0) return;
            
            // Calcular el peso total actual de los otros gÃ©neros
            const totalOtherWeights = otherGenres.reduce((sum, genre) => sum + genre.weight, 0);
            
            if (totalOtherWeights === 0) {
                // Si todos los otros estÃ¡n en 0, distribuir equitativamente
                const remainingWeight = 100 - newWeight;
                const equalWeight = remainingWeight / otherGenres.length;
                
                appState.selectedGenres.forEach((genre, index) => {
                    if (index !== changedIndex) {
                        genre.weight = equalWeight;
                    }
                });
            } else {
                // Redistribuir proporcionalmente basado en pesos actuales
                const targetTotalOther = 100 - newWeight;
                const scaleFactor = targetTotalOther / totalOtherWeights;
                
                // Aplicar el factor de escala manteniendo proporciones
                appState.selectedGenres.forEach((genre, index) => {
                    if (index !== changedIndex) {
                        genre.weight = Math.max(5, genre.weight * scaleFactor);
                    }
                });
                
                // Ajuste fino para asegurar que sume exactamente 100
                const currentTotal = appState.selectedGenres.reduce((sum, g) => sum + g.weight, 0);
                if (Math.abs(currentTotal - 100) > 0.1) {
                    const adjustment = (100 - currentTotal) / otherGenres.length;
                    appState.selectedGenres.forEach((genre, index) => {
                        if (index !== changedIndex) {
                            genre.weight = Math.max(5, genre.weight + adjustment);
                        }
                    });
                }
            }
        };

        // Actualizar todas las visualizaciones de peso
        const updateAllWeightDisplays = () => {
            const sliders = document.querySelectorAll('.weight-slider');
            const percentages = document.querySelectorAll('.text-xs.text-gray-400');
            
            appState.selectedGenres.forEach((genre, index) => {
                if (sliders[index]) {
                    sliders[index].value = Math.round(genre.weight);
                }
                if (percentages[index]) {
                    percentages[index].textContent = `${Math.round(genre.weight)}%`;
                }
            });
            
            // Actualizar indicador total
            const totalIndicator = document.getElementById('totalWeightIndicator');
            if (totalIndicator) {
                const total = appState.selectedGenres.reduce((sum, g) => sum + g.weight, 0);
                totalIndicator.textContent = `Total: ${Math.round(total)}%`;
                totalIndicator.className = Math.abs(total - 100) < 0.1 ? 
                    'text-sm font-medium text-green-400' : 
                    'text-sm font-medium text-yellow-400';
            }
        };

        // Actualizar contador de gÃ©neros
        const updateGenreCount = () => {
